# PHP AST Analyzer

Инструмент для автоматического анализа PHP-кода с использованием AST парсера и генерации документации в формате CSV.

## Возможности

- **Автоматическое извлечение элементов**: классы, методы, свойства, функции, переменные, константы
- **Интеграция с описаниями**: поддержка JSON-файлов с предопределенными описаниями
- **Генерация отчетов**: CSV файлы с структурированной информацией
- **Поиск дубликатов**: автоматическое обнаружение повторяющихся элементов
- **Статистика**: подробная статистика по найденным и отсутствующим описаниям

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd php-ast-analyzer
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Установите PHP-Parser:
```bash
composer require nikic/php-parser
```

## Требования

- **Python**: 3.8+
- **PHP**: 7.4+
- **Composer**: для установки PHP-Parser

## Использование

### Базовое использование

```bash
python main.py /path/to/php/project --output analysis.csv
```

### Расширенные параметры

```bash
python main.py /path/to/php/project \
  --descriptions custom_descriptions \
  --output detailed_analysis.csv \
  --partial-match \
  --short-names \
  --debug
```

### Параметры командной строки

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `directory` | Директория с PHP-файлами | Обязательный |
| `--descriptions` | Директория с JSON-файлами описаний | `descriptions` |
| `--output` | Имя выходного CSV-файла | `php_analysis.csv` |
| `--exact-match` | Точное сравнение имен | Включено |
| `--partial-match` | Частичное сравнение имен | Выключено |
| `--full-names` | Показывать полные имена | Включено |
| `--short-names` | Показывать короткие имена | Выключено |
| `--include-lines` | Включать номера строк | Включено |
| `--skip-composer` | Пропустить установку PHP-Parser | Выключено |
| `--debug` | Включить отладочный вывод | Выключено |

## Структура проекта

```
php-ast-analyzer/
├── src/
│   ├── config.py          # Конфигурационные параметры
│   ├── csv_writer.py      # Запись CSV-файлов
│   ├── description_manager.py # Управление описаниями
│   ├── php_analyzer.py    # Основной анализатор
│   ├── php_parser.py      # PHP AST парсер
│   ├── utils.py           # Вспомогательные функции
│   └── main.py           # Точка входа
├── descriptions/          # JSON-файлы описаний
├── vendor/               # PHP зависимости
└── php_ast_parser.php    # Генерируемый PHP-скрипт
```

## Формат JSON-описаний

### Поддерживаемые форматы

1. **Массив объектов**:
```json
[
  {"name": "ClassName", "desc": "Описание класса"},
  {"name": "methodName", "desc": "Описание метода"}
]
```

2. **Массив словарей**:
```json
[
  {"ClassName": "Описание класса"},
  {"methodName": "Описание метода"}
]
```

3. **Единый словарь**:
```json
{
  "ClassName": "Описание класса",
  "methodName": "Описание метода"
}
```

### Файлы описаний

- `classes.json` - описания классов
- `methods.json` - описания методов
- `propertys.json` - описания свойств
- `functions.json` - описания функций
- `variables.json` - описания переменных
- `constants.json` - описания констант
- `class_constants.json` - описания констант классов

## Пример использования

1. Подготовьте файлы описаний в папке `descriptions/`
2. Запустите анализ:
```bash
python main.py /var/www/project --output documentation.csv
```
3. Откройте сгенерированный CSV-файл в Excel или другом редакторе

## Особенности

- **Автоматическое сохранение**: найденные описания сохраняются в файлы `found_*.json`
- **Статистика**: подробный отчет по обработанным элементам
- **Гибкая настройка**: множество параметров для тонкой настройки анализа
- **Поддержка DocBlock**: автоматическое извлечение описаний из PHP-комментариев

## Ограничения

- Требуется установленный PHP и Composer
- PHP-Parser должен быть установлен через Composer
- Анализируются только файлы с расширением `.php`

## Лицензия

Проект распространяется под лицензией MIT.